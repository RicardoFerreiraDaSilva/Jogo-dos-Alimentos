<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Santu√°rio do Gato Rob√¥</title>
    <style>
        body { display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #222; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
        .hidden { display: none !important; }
        #main-container { display: flex; gap: 20px; align-items: flex-start; }
        #game-container { position: relative; }
        #game-area { width: 800px; height: 600px; border: 2px solid #fff; background: url('imagens/bosque_rosa.png') center/cover no-repeat; position: relative; overflow: hidden; }
        .entity { position: absolute; background-size: contain; background-repeat: no-repeat; cursor: pointer; }
        #player { width: 64px; height: 64px; background-image: url('imagens/gatinho_pixel_32x32.png'); z-index: 10; cursor: default; }
        #robot-cat { width: 96px; height: 96px; background-image: url('imagens/gato_robo.png'); z-index: 9; }
        #cookie-machine { width: 160px; height: 240px; background-image: url('imagens/maquina_biscoito.png'); z-index: 9; }
        #card-machine { width: 160px; height: 240px; background-image: url('imagens/maquina_cartas.png'); z-index: 9; }
        #ui-column { display: flex; flex-direction: column; align-items: center; }
        #status-board { font-size: 18px; margin-bottom: 10px; text-align: left; width: 250px; }
        #inventory-display { width: 250px; height: 550px; background-color: #1c2833; border: 2px solid #fff; padding: 10px; box-sizing: border-box; overflow-y: auto; }
        #inventory-title { margin: 0 0 10px 0; text-align: center; font-size: 20px; }
        .inventory-item { padding: 5px; border-bottom: 1px solid #444; }
        .golden-item { color: #f1c40f; font-weight: bold; }
        #dialogue-box { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 750px; padding: 20px; background-color: rgba(10, 20, 40, 0.9); border: 3px solid #00c2ff; border-radius: 10px; box-sizing: border-box; text-align: center; z-index: 200; }
        #dialogue-text { font-size: 22px; margin: 0 0 20px 0; min-height: 50px; line-height: 1.4; white-space: pre-wrap; }
        #dialogue-options { max-height: 300px; overflow-y: auto; padding-right: 10px; }
        #dialogue-options button { display: block; width: 100%; text-align: left; font-size: 18px; padding: 10px 20px; border: 2px solid #00c2ff; background-color: #2c3e50; color: white; border-radius: 5px; cursor: pointer; margin: 5px 0; }
        #dialogue-options button:hover { background-color: #4a6581; }
        #dialogue-options button:disabled { background-color: #222; color: #555; cursor: not-allowed; border-color: #555; }
        #proceed-button { position: absolute; bottom: 20px; right: 20px; padding: 15px 30px; font-size: 22px; cursor: pointer; background-color:#27ae60; border: 2px solid #2ecc71; color: white; border-radius: 10px; z-index: 150; }
    </style>
</head>
<body>
    <div id="main-container"> 
        <div id="game-container"> 
            <div id="game-area">
                <div id="player" class="entity"></div>
                <div id="robot-cat" class="entity"></div>
                <div id="cookie-machine" class="entity"></div>
                <div id="card-machine" class="entity"></div>
                
                <div id="dialogue-box" class="hidden"> 
                    <p id="dialogue-text"></p>
                    <div id="dialogue-options"></div>
                </div>
                
                <button id="proceed-button">Ir para a pr√≥xima sala</button>
            </div>
        </div> 
        <div id="ui-column"> 
            <div id="status-board">
                <div>Sala: <span id="current-room"></span></div> 
                <div>Vida: <span id="player-health"></span></div> 
                <div>Escudo: <span id="player-shield"></span></div> 
                <div>Ataque: <span id="player-attack"></span></div> 
                <div>Moedas: <span id="player-coins"></span></div> 
            </div> 
            <div id="inventory-display"><h3 id="inventory-title">Invent√°rio</h3><div id="inventory-list"></div></div> 
        </div> 
    </div>

    <script>
    // --- ESTADO DO JOGADOR ---
    function getNewPlayerState() {
        const state = { 
            x: 385, y: 520, speed: 4, baseHealth: 10, bonusHealth: 0, baseAttack: 1, bonusAttack: 0, shield: 0, coins: 300, 
            inventory: new Map(), currentRoom: 0, 
            cartasCompradas: [], 
            npcsEncontrados: [],
            totalCompras: 0,
            specialDishes: [],
            permanentUnlocks: {}
        };
        Object.defineProperty(state, 'health', { get() { return this.baseHealth + this.bonusHealth; }, configurable: true });
        Object.defineProperty(state, 'attack', { get() { return this.baseAttack + this.bonusAttack; }, configurable: true });
        return state;
    }
    
    const SAVE_KEY = 'meuJoguinhoState_v27';

    function savePlayerState(state) {
        const savableState = { ...state, inventory: Array.from(state.inventory.entries()) };
        localStorage.setItem(SAVE_KEY, JSON.stringify(savableState));
    }

    function loadPlayerState() {
        const savedStateJSON = localStorage.getItem(SAVE_KEY);
        if (!savedStateJSON) return null;
        const loadedObject = JSON.parse(savedStateJSON);
        const baseState = getNewPlayerState();
        const restoredState = { ...baseState, ...loadedObject, inventory: new Map(loadedObject.inventory) };
        Object.defineProperty(restoredState, 'health', { get() { return restoredState.baseHealth + restoredState.bonusHealth; }, configurable: true });
        Object.defineProperty(restoredState, 'attack', { get() { return restoredState.baseAttack + restoredState.bonusAttack; }, configurable: true });
        return restoredState;
    };

    const refs = {
        player: document.getElementById('player'), robotCat: document.getElementById('robot-cat'),
        cookieMachine: document.getElementById('cookie-machine'), cardMachine: document.getElementById('card-machine'),
        gameArea: document.getElementById('game-area'), dialogueBox: document.getElementById('dialogue-box'), 
        dialogueText: document.getElementById('dialogue-text'), dialogueOptions: document.getElementById('dialogue-options'),
        proceedButton: document.getElementById('proceed-button'),
        ui: { room: document.getElementById('current-room'), health: document.getElementById('player-health'), shield: document.getElementById('player-shield'), attack: document.getElementById('player-attack'), coins: document.getElementById('player-coins'), inventory: document.getElementById('inventory-list') }
    };
    
    let playerState = loadPlayerState() || getNewPlayerState();
    let gameState = 'IDLE';
    let cookiesBoughtThisRoom = 0;
    const keys = { ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false };

    // --- LISTA DE CARTAS COMPLETA E ATUALIZADA ---
    const masterCardList = [
        // NPCs Mercadores
        { id: 'card_raposa', name: 'Gabriel, o Mercador Raposa', details: { emoji: 'ü¶ä', title: 'O Mercador Aventureiro', origin: 'Reino das Frutas', location: 'Bosques Verdejantes', favoriteFood: 'Churrasco', favoriteGroups: 'Carnes, Ovos e Cereais', favoriteColor: 'Vermelho', relationships: 'Amigo pr√≥ximo do Gato Cavaleiro e respeitado por todos na floresta.', philosophy: '‚ÄúExerc√≠cios f√≠sicos s√£o t√£o importantes quanto uma boa alimenta√ß√£o!‚Äù' }},
        { id: 'card_urso', name: 'Arthur, o Mercador Urso', details: { emoji: 'üêª', title: 'O Comerciante Robusto', origin: 'Reino das Carnes e Ovos', location: 'Bosques Roxos', favoriteFood: 'Mel e Nozes', favoriteGroups: 'A√ß√∫cares e Doces (com modera√ß√£o!)', favoriteColor: 'Cinza', relationships: 'Grande admirador da sabedoria do Mercador Tartaruga.', philosophy: '‚ÄúUma alimenta√ß√£o nutritiva √© a base para o verdadeiro vigor.‚Äù' }},
        { id: 'card_coelha', name: 'Vit√≥ria, a Mercadora Coelha', details: { emoji: 'üê∞', title: 'A Empreendedora Novata', origin: 'Reino das Hortali√ßas', location: 'Clareiras Alaranjadas', favoriteFood: 'Cenoura e Couve', favoriteColor: 'Laranja', relationships: 'Pr√≥xima da Mercadora Vaca e do Mercador Tartaruga.', philosophy: '‚ÄúSonho com uma vida melhor para mim e minha fam√≠lia, com comida de verdade para todos!‚Äù' }},
        { id: 'card_vaca', name: 'Camile, a Mercadora Vaca', details: { emoji: 'üêÆ', title: 'A Rainha dos Latic√≠nios', origin: 'Reino dos Latic√≠nios', location: 'Bosques Floridos Mistos', favoriteFood: 'Br√≥colis', favoriteGroups: 'Hortali√ßas e Frutas', favoriteColor: 'Azul', relationships: 'Muito amiga da Mercadora Coelha e do Mercador Urso.', philosophy: '‚ÄúEstilo √© tudo, querido. E essa Rainha Uva... que deseleg√¢ncia!‚Äù' }},

        // Outros NPCs
        { id: 'card_gato_coringa', name: 'Gato Coringa', details: { emoji: 'üÉè', title: 'O Agente do Caos', origin: 'Dimens√£o do Acaso', location: 'Qualquer lugar, a qualquer hora', favoriteFood: 'Guisado do Coringa (a receita muda a cada garfada)', favoriteColor: 'Roxo e Verde', relationships: 'Ningu√©m. Rela√ß√µes s√£o muito previs√≠veis.', philosophy: '‚ÄúEquil√≠brio? A verdadeira gra√ßa est√° no delicioso caos da incerteza! Hahaha!‚Äù' }},
        { id: 'card_gato_robo', name: 'Gato Rob√¥', details: { emoji: 'ü§ñ', title: 'O Arquivista Cibern√©tico', origin: 'Planeta Technutron 5000', location: 'Santu√°rio Tecnol√≥gico (Bosque Rosa)', favoriteFood: 'Dados puros (mas aceita um Biscoito para an√°lise).', favoriteColor: 'Ciano', relationships: 'Conectado √† rede neural da floresta.', philosophy: '‚ÄúA informa√ß√£o √© o nutriente supremo. Uma dieta balanceada otimiza a performance.‚Äù' }},
        { id: 'card_gato_cavaleiro', name: 'Gato Cavaleiro', details: { emoji: '‚öîÔ∏è', title: 'O Paladino das Prote√≠nas', origin: 'O Grande Sal√£o de Val-Miau-a', location: 'Arenas de Treinamento', favoriteFood: 'Peixe do Cavaleiro', favoriteColor: 'Prata', relationships: 'Respeito m√∫tuo com Gabriel, a Raposa.', philosophy: '‚ÄúA verdadeira for√ßa n√£o vem s√≥ dos m√∫sculos, mas de um prato nobre e honrado!‚Äù' }},
        { id: 'card_fazendeiro', name: 'Cachorro Fazendeiro', details: { emoji: 'üë®‚Äçüåæ', title: 'O Guardi√£o da Colheita', origin: 'As Colinas F√©rteis (Nativo deste mundo)', location: 'Campos de Morangos', favoriteFood: 'Morango Brilhante', favoriteColor: 'Marrom Terra', relationships: 'Fornecedor para todos os mercadores justos.', philosophy: '‚ÄúA terra nos d√° tudo, mas a Rainha esqueceu que variedade √© o tempero da vida.‚Äù' }},
        { id: 'card_gato_mago', name: 'Gato Mago', details: { emoji: 'üßô', title: 'O Alquimista Culin√°rio', origin: 'Plano Et√©reo dos Sabores', location: 'Bosques Azulados e M√°gicos', favoriteFood: 'Pratos m√°gicos que nunca se repetem.', favoriteColor: 'Azul Astral', relationships: 'Uma figura enigm√°tica e mentora para os perdidos.', philosophy: '‚ÄúCada ingrediente √© um encantamento. A magia de verdade est√° em um prato equilibrado!‚Äù' }},
        { id: 'card_gato_sorte', name: 'Gato da Sorte', details: { emoji: 'üçÄ', title: 'O Viajante Afortunado', origin: 'Um mundo onde a sorte √© uma moeda real.', location: 'Bosques Amarelos e Dourados', favoriteFood: 'Moedas de Chocolate', favoriteColor: 'Dourado', relationships: 'Aparece para quem mais precisa.', philosophy: '‚ÄúO equil√≠brio n√£o √© s√≥ sobre comida, √© sobre sorte. E eu sou a prova de que voc√™ n√£o est√° sozinho.‚Äù' }},

        // Cards Educacionais dos Grupos Alimentares
        { id: 'card_group_cereais', name: 'Card Grupo: Cereais e Tub√©rculos', desc: "A base da nossa pir√¢mide! Itens como P√£o, Arroz e Batata s√£o ricos em carboidratos, a principal fonte de energia para o corpo se mover, pensar e lutar. Sem eles, at√© o guerreiro mais forte se sentiria fraco." },
        { id: 'card_group_hortalicas', name: 'Card Grupo: Hortali√ßas', desc: "Essenciais para a defesa do corpo! Alimentos como Cenoura e Br√≥colis s√£o repletos de vitaminas, minerais e fibras. Eles regulam as fun√ß√µes do organismo e protegem contra doen√ßas, como um verdadeiro escudo natural." },
        { id: 'card_group_frutas', name: 'Card Grupo: Frutas', desc: "Doces e poderosas! Frutas como Banana e Laranja s√£o fontes r√°pidas de energia, vitaminas e fibras. Ajudam na hidrata√ß√£o e na sa√∫de da pele. A Rainha Uva pode ter exagerado, mas elas s√£o muito importantes!" },
        { id: 'card_group_laticinios', name: 'Card Grupo: Leites e Latic√≠nios', desc: "Fundamentais para estruturas fortes! Leite, Queijo e Iogurte s√£o as maiores fontes de C√°lcio, mineral essencial para a sa√∫de dos ossos e dentes. Tamb√©m fornecem prote√≠nas de alta qualidade." },
        { id: 'card_group_carnes', name: 'Card Grupo: Carnes e Ovos', desc: "Para for√ßa e reparo! Carnes e Ovos s√£o as principais fontes de prote√≠nas, os 'tijolos' do nosso corpo. Eles constroem e reparam os m√∫sculos e tecidos, al√©m de serem ricos em ferro para combater o cansa√ßo." },
        { id: 'card_group_leguminosas', name: 'Card Grupo: Leguminosas', desc: "Prote√≠na que vem da terra! Feij√£o, Nozes e Pinh√£o s√£o excelentes fontes de prote√≠na vegetal e fibras. Eles garantem energia duradoura e ajudam no bom funcionamento do sistema digestivo." },
        { id: 'card_group_gorduras', name: 'Card Grupo: √ìleos e Gorduras', desc: "Energia concentrada! Itens como Manteiga devem ser usados com modera√ß√£o. As gorduras s√£o importantes para proteger nossos √≥rg√£os e para absorver certas vitaminas, mas o excesso pode ser prejudicial." },
        { id: 'card_group_doces', name: 'Card Grupo: A√ß√∫cares e Doces', desc: "O prazer com modera√ß√£o! Chocolate, Mel e Bolos fornecem energia r√°pida, mas geralmente n√£o possuem muitos nutrientes. S√£o deliciosos, mas devem ficar no topo da pir√¢mide: consuma em pequenas quantidades!" },
        
        // Cards de Itens e Mec√¢nicas
        { id: 'card_peixe_cavaleiro', name: 'Card: Peixe do Cavaleiro', desc: "Item lend√°rio. Se voc√™ n√£o tomar dano em uma sala de combate, ganha +30 de dano permanentemente. Recompensa para guerreiros habilidosos."},
        { id: 'card_morango_brilhante', name: 'Card: Morango Brilhante', desc: "Item especial. Concede +1 Vida, +1 Ataque, +1 Escudo, +10% de chance rara e um tiro teleguiado adicional."},
        { id: 'card_mel_lendario', name: 'Card: Mel Lend√°rio', desc: "Item lend√°rio exclusivo do Mercador Urso. Permite conjurar abelhas teleguiadas que atacam seus inimigos."},
        { id: 'card_queijo_suico', name: 'Card: Queijo Su√≠√ßo Raro', desc: "Item raro exclusivo da Vaca Mercadora. Se n√£o tomar dano em uma sala, h√° 50% de chance de ganhar um escudo protetor."},
        { id: 'card_guisado_coringa', name: 'Card: Guisado do Coringa', desc: "Um pr√™mio especial do quiz do Coringa. Concede um massivo b√¥nus de 50 de dano de espinhos."},
        { id: 'card_pizza_celestial', name: 'Card: Pizza Celestial', desc: "O pr√™mio final do Gato Coringa. Aparentemente n√£o faz nada, mas o conhecimento de que voc√™ a possui enche voc√™ de determina√ß√£o."},
        { id: 'card_companheiros', name: 'Card Mec√¢nica: Companheiros', desc: "Itens como o Chocolate e o Iogurte conjuram amigos para lutar ao seu lado."},
        { id: 'card_desconto', name: 'Card Conquista: Cliente Fiel', desc: "Voc√™ √© um cliente fiel! Concede um pequeno desconto permanente em todas as lojas."}
    ];

    function updateUI() {
        const ui = refs.ui;
        if (!playerState) return;
        ui.room.textContent = playerState.currentRoom; ui.health.textContent = playerState.health.toFixed(0); ui.shield.textContent = playerState.shield.toFixed(0); ui.attack.textContent = playerState.attack.toFixed(0); ui.coins.textContent = playerState.coins;
        ui.inventory.innerHTML = '';
        playerState.inventory.forEach((count, name) => {
            const itemEl = document.createElement('div');
            itemEl.className = 'inventory-item';
            if (['Peixe do Cavaleiro', 'Morango Brilhante', 'Mel', 'Queijo Sui√ßo', 'Guisado do Coringa', 'Pizza Celestial'].includes(name)) itemEl.classList.add('golden-item');
            itemEl.textContent = `${name} ${count > 1 ? `x${count}`: ''}`;
            ui.inventory.appendChild(itemEl);
        });
    }

    function showDialogue(text, options = []) {
        gameState = 'DIALOGUE'; refs.dialogueText.textContent = text; refs.dialogueOptions.innerHTML = '';
        options.forEach(option => {
            const button = document.createElement('button'); button.textContent = option.text;
            if (option.disabled) button.disabled = true;
            button.onclick = () => { if(option.action) option.action(); };
            refs.dialogueOptions.appendChild(button);
        });
        refs.dialogueBox.classList.remove('hidden');
    }

    function hideDialogue() { refs.dialogueBox.classList.add('hidden'); gameState = 'IDLE'; }

    function interactWithRobotCat() {
        if (gameState !== 'IDLE') return;
        showDialogue("Ol√°, unidade org√¢nica. An√°lise: voc√™ busca otimiza√ß√£o. A Rainha Uva prega for√ßa atrav√©s da restri√ß√£o, um paradigma falho. A verdadeira efici√™ncia vem do conhecimento e de uma dieta balanceada. Use minhas m√°quinas para expandir seus dados.", [{ text: "An√°lise interessante.", action: hideDialogue }]);
    }
    
    function interactWithCookieMachine() {
        if (gameState !== 'IDLE' && gameState !== 'DIALOGUE') return;
        if (cookiesBoughtThisRoom >= 10) {
            showDialogue("Alerta de sistema: consumo excessivo de calorias vazias detectado. Modera√ß√£o √© crucial para uma dieta balanceada. Dispensador bloqueado para esta visita.", [{ text: "Entendido.", action: hideDialogue }]);
            return;
        }
        const buyAction = () => {
            if (playerState.coins >= 1) {
                playerState.coins -= 1;
                playerState.baseHealth += 5;
                playerState.coins += 5;
                cookiesBoughtThisRoom++;
                updateUI();
                interactWithCookieMachine(); 
            } else {
                showDialogue("Moedas insuficientes.", [{ text: "Fechar", action: hideDialogue }]);
            }
        };
        const options = [
            { text: `Pagar 1 moeda (+5 Vida, +5 Moedas)`, action: buyAction },
            { text: "Sair", action: hideDialogue }
        ];
        if (playerState.coins < 1) options[0].disabled = true;
        showDialogue(`Dispensador Nutritivo. Unidades restantes: ${10 - cookiesBoughtThisRoom}`, options);
    }

    function interactWithCardMachine() {
        if (gameState !== 'IDLE') return;
        const availableCards = masterCardList.filter(card => !playerState.cartasCompradas.includes(card.id));
        
        if (availableCards.length === 0) {
            showDialogue("Processando... Todos os pacotes de dados dispon√≠veis para seu perfil j√° foram adquiridos. Parab√©ns, unidade org√¢nica, seu conhecimento est√° completo.", [{ text: "Excelente.", action: hideDialogue }]);
            return;
        }
        const cardOptions = availableCards.map(card => ({
            text: `Comprar '${card.name}' (100 moedas)`,
            disabled: playerState.coins < 100,
            action: () => buyCard(card)
        }));
        cardOptions.push({ text: "Sair", action: hideDialogue });
        showDialogue("Bem-vindo ao terminal de conhecimento. Todos os pacotes de dados est√£o dispon√≠veis para download:", cardOptions);
    }

    function buyCard(card) {
        if (playerState.coins >= 100) {
            playerState.coins -= 100;
            playerState.cartasCompradas.push(card.id);
            if (!playerState.permanentUnlocks) playerState.permanentUnlocks = {};
            playerState.permanentUnlocks.cardViewerEnabled = true;
            updateUI();
            
            // Mostra a descri√ß√£o da carta comprada
            let cardDescription = card.desc;
            if (card.details && card.details.philosophy) {
                cardDescription = card.details.philosophy;
            } else if (card.details && card.details.title) {
                cardDescription = card.details.title;
            }

            showDialogue(`Download completo!\n\n${card.name}\n"${cardDescription}"`, [
                { text: "Adquirir outro", action: () => interactWithCardMachine() },
                { text: "Sair", action: hideDialogue }
            ]);
        }
    }

    function gameLoop() {
        if (gameState === 'IDLE') {
            if (keys.ArrowUp) playerState.y -= playerState.speed; if (keys.ArrowDown) playerState.y += playerState.speed;
            if (keys.ArrowLeft) playerState.x -= playerState.speed; if (keys.ArrowRight) playerState.x += playerState.speed;
            playerState.x = Math.max(0, Math.min(playerState.x, 800 - 64));
            playerState.y = Math.max(0, Math.min(playerState.y, 600 - 64));
            refs.player.style.left = `${playerState.x}px`;
            refs.player.style.top = `${playerState.y}px`;
        }
        requestAnimationFrame(gameLoop);
    }
    
    function initRoom() {
        playerState.x = 368; playerState.y = 450;
        refs.robotCat.style.left = `352px`; refs.robotCat.style.top = `280px`;
        refs.cookieMachine.style.left = '100px'; refs.cookieMachine.style.top = '180px';
        refs.cardMachine.style.left = '540px'; refs.cardMachine.style.top = '180px';
        
        if (!playerState.npcsEncontrados) playerState.npcsEncontrados = [];
        if (!playerState.npcsEncontrados.includes('gatoRobo')) {
            playerState.npcsEncontrados.push('gatoRobo');
        }
        
        refs.robotCat.addEventListener('click', interactWithRobotCat);
        refs.cookieMachine.addEventListener('click', interactWithCookieMachine);
        refs.cardMachine.addEventListener('click', interactWithCardMachine);
        refs.proceedButton.addEventListener('click', () => { savePlayerState(playerState); window.location.href = 'jogosalas.html'; });
        document.addEventListener('keydown', e => { if (keys.hasOwnProperty(e.key)) keys[e.key] = true; });
        window.addEventListener('keyup', e => { if (keys.hasOwnProperty(e.key)) keys[e.key] = false; });
        
        updateUI(); 
        gameLoop();
    }
    initRoom();
    </script>
</body>
</html>